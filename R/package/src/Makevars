AR     = ar
RANLIB = ranlib

PKG_CPPFLAGS = \
-I include/genfile/include \
-I include/db/include \
-D SQLITE_ENABLE_COLUMN_METADATA \
-D SQLITE_ENABLE_STAT4 \
-D SQLITE_MAX_EXPR_DEPTH=10000 \
-D SQLITE_USE_URI=1 \
-Wno-unused-local-typedefs \
-fPIC -O3

PKG_LIBS = -lsqlite3 -lboost_iostreams -lboost_system -lboost_filesystem -lboost_thread -lboost_timer -lboost_chrono -lboost_date_time -lzstd -pthread -lpthread

LIBDB_SOURCES = $(wildcard db/*.cpp)
LIBDB_OBJECTS = $(patsubst %.cpp,%.o,$(LIBDB_SOURCES))
CXX_SOURCES = $(wildcard bgen/*.cpp) $(LIBDB_SOURCES)
CXX_OBJECTS = $(patsubst %.cpp,%.o,$(CXX_SOURCES))
OBJECTS = RcppExports.o load.o $(CXX_OBJECTS) $(C_OBJECTS)

$(info $(C_OBJECTS))
$(info $(CXX_OBJECTS))

.PHONY: all
all: $(SHLIB)
$(SHLIB): $(OBJECTS) librbgen.a libdb.a Makevars

libdb.a:
	$(AR) cru $@ $(LIBDB_OBJECTS)
	$(RANLIB) $@

librbgen.a:
	$(AR) cru $@ $(OBJECTS)
	$(RANLIB) $@
