import os.path

def build( bld ):
	sources = [ 'sqlite3/sqlite3.c' ]
	bld.stlib(
		target = 'sqlite3',
		source = sources,
		features = [ 'c' ],
		includes = './',
		cflags = '-fPIC',
		defines = 'SQLITE_ENABLE_COLUMN_METADATA SQLITE_ENABLE_STAT4 SQLITE_MAX_EXPR_DEPTH=10000',
		#uselib = 'DL',
		export_includes = './'
	)
	# Copy files into rbgen package directory
	# This needs extra files not among the cpp files above, so we recursively copy directories
	for source in sources:
		bld( rule = 'cp ${SRC} ${TGT}', source = source, target = '../../R/rbgen/src/sqlite3/' + os.path.basename( source ), always = True )
